<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- ===== HTMLãƒ˜ãƒƒãƒ€ ===== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ³ãƒ‰ãƒœãƒ¼ãƒ«è©¦åˆè¨˜éŒ²</title>
    
  <!-- ===== PWAé–¢é€£ ===== -->
  <link rel="manifest" href="/handball-recorder/manifest-v2.webmanifest?v=2">

    <!-- ===== CSSã“ã“ã‹ã‚‰ ===== -->
    <style>
        /* å…¨ä½“ã®åŸºæœ¬è¨­å®š */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            overflow: auto;
            min-height: 100vh;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* ãƒ¡ã‚¤ãƒ³ç”»é¢ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆ */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ãƒ¡ã‚¤ãƒ³è¨˜éŒ²ç”»é¢ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .main-screen {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto auto 1fr auto;
            gap: 1vw;
            padding: 1vw;
            min-height: 100vh;
            width: 100%;
            box-sizing: border-box;
        }

        /* 1è¡Œç›®ï¼šã‚¿ã‚¤ãƒãƒ¼ã€ã‚¹ã‚³ã‚¢ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .top-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1vw;
        }

        .timer-area {
            grid-column: 1;
        }

        .score-area {
            grid-column: 2;
        }

        .action-area {
            grid-column: 3 / span 2;
        }

        /* 2è¡Œç›®ï¼šã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ã€è‡ªãƒãƒ¼ãƒ ã€ç›¸æ‰‹ãƒãƒ¼ãƒ  */
        .middle-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1vw;
        }

        .goal-area {
            grid-column: 1 / span 2;
        }

        .my-team-area {
            grid-column: 3;
        }

        .opponent-team-area {
            grid-column: 4;
        }


        /* 3è¡Œç›®ï¼šè¨˜éŒ²ãƒ»çµ±è¨ˆãƒœã‚¿ãƒ³ */
        .bottom-row {
            width: 100%;
        }

        .bottom-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1vw;
            width: 100%;
        }


        /* ã‚¿ã‚¤ãƒãƒ¼ã‚¨ãƒªã‚¢ */
        .timer-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5vw;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .timer-display {
            font-size: 3vw;
            font-weight: bold;
            text-align: center;
            margin-bottom: 0.5vh;
            color: #4ecdc4;
            text-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }

        .timer-sub {
            font-size: 1.2vw;
            text-align: center;
            color: #aaa;
            margin-bottom: 1vh;
        }

        .timer-controls {
            display: flex;
            gap: 0.5vw;
            justify-content: center;
        }

        .timer-btn {
            padding: 2vh 3vw;
            border: none;
            border-radius: 8px;
            font-size: 2vw;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .timer-btn.start {
            background: #4ecdc4;
            color: #1a1a2e;
        }

        .timer-btn.pause {
            background: #ff6b6b;
            color: white;
        }

        .timer-btn.reset {
            background: #95a5a6;
            color: white;
        }

        .timer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* å‰å¾ŒåŠåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */  
        .half-switch {
            margin-top: 0.8vh;
            text-align: center;
        }

        #halfBtn {
            padding: 1vh 2vw;
            font-size: 0.9vw;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            background: #4ecdc4;
            color: #1a1a2e;
            font-weight: bold;
        }

        #halfBtn.second {
            background: #ff6b6b;
            color: white;
        }




        /* ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */
        .goal-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1vw;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .goal-title {
            text-align: center;
            margin-bottom: 1vh;
            font-size: 2vw;
            font-weight: bold;
        }

        .goal-grid {
            display: grid;
            grid-template-columns: 4vw 1fr 4vw;
            grid-template-rows: 3vh 1fr 3vh;
            gap: 0.5vw;
            height: calc(100% - 4vh);
        }

        .goal-grid {
            display: grid;
            grid-template-columns: 60px 1fr 60px;
            grid-template-rows: 40px 1fr 40px;
            gap: 8px;
            height: calc(100% - 50px);
        }

        /* ã‚´ãƒ¼ãƒ«å¤–ãƒœã‚¿ãƒ³ï¼ˆã‚³ãƒ¼ãƒŠãƒ¼ï¼‰ */
        .goal-btn.corner-tl {
            grid-column: 1;
            grid-row: 1;
        }

        .goal-btn.corner-top {
            grid-column: 2;
            grid-row: 1;
        }

        .goal-btn.corner-tr {
            grid-column: 3;
            grid-row: 1;
        }

        /* å·¦å³ã®æ¨ªå¤–ãƒœã‚¿ãƒ³ï¼ˆç¸¦é•·ï¼‰ */
        .goal-btn.side-left {
            grid-column: 1;
            grid-row: 2;
        }

        .goal-btn.side-right {
            grid-column: 3;
            grid-row: 2;
        }

        /* ã‚´ãƒ¼ãƒ«å†…ã®6åˆ†å‰² */
        .goal-inner {
            grid-column: 2;
            grid-row: 2;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 6px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px;
            border-radius: 8px;
            border: 3px solid #4ecdc4;
        }

        .goal-btn {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1vw;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .goal-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            transform: scale(1.05);
        }

        .goal-btn:active {
            background: rgba(78, 205, 196, 0.5);
        }

        /* ã‚´ãƒ¼ãƒ«ä½ç½®é¸æŠå¾Œã®åˆ¥ç”»é¢è¨­å®š */
        .action-btn {
            flex: 1;
            padding: 12px;
            font-size: 20px;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;

            border-radius: 12px;
        }

        /* è‰²ã ã‘åˆ†é›¢ */
        .result-goal {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .result-saved {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
        }

        .result-miss {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }



        /* è‡ªãƒãƒ¼ãƒ èƒŒç•ªå·ã‚¨ãƒªã‚¢ */
        .my-team-area {
            background: rgba(78, 205, 196, 0.15);
            border-radius: 12px;
            padding: 1vw;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(78, 205, 196, 0.3);
            overflow-y: auto;
        }

        .team-title {
            text-align: center;
            margin-bottom: 1vh;
            font-size: 1.3vw;
            font-weight: bold;
            color: #4ecdc4;
        }

        .player-grid {
            display: grid;
            grid-template-rows: repeat(10, 1fr);
            grid-auto-flow: column;
            gap: 0.4vw;
            flex: 1;
        }

        .player-btn {
            width: 100%;
            height: 100%;

            padding: 0.4vh 0.5vw;

            display: flex;
            flex-direction: column;
            justify-content: center;

            border: 2px solid rgba(78, 205, 196, 0.5);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 0.9vw;
            box-sizing: border-box;
        }

        .player-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            transform: translateX(5px);
        }

        .player-btn.selected {
            background: #4ecdc4;
            color: #1a1a2e;
            font-weight: bold;
        }

        .player-number {
            font-size: 1.2vw;
            font-weight: bold;
            margin-bottom: 0.2vh;
        }

        .player-name {
            font-size: 0.8vw;
            opacity: 0.9;
        }

        /* ç›¸æ‰‹ãƒãƒ¼ãƒ èƒŒç•ªå·ã‚¨ãƒªã‚¢ */
        .opponent-team-area {
            display: flex;
            flex-direction: column;
            background: rgba(255, 107, 107, 0.15);
            border-radius: 12px;
            padding: 1vw;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 107, 107, 0.3);
            overflow-y: auto;
        }

        .opponent-team-area .team-title {
            color: #ff6b6b;
        }

        .opponent-team-area .player-btn {
            border-color: rgba(255, 107, 107, 0.5);
            text-align: left;
        }

        .opponent-team-area .player-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        .opponent-team-area .player-btn.selected {
            background: #ff6b6b;
            color: white;
        }

        /* ä¸‹éƒ¨ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .bottom-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1vw;
        }

        .bottom-btn {
            padding: 1.5vh;
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.3vw;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .bottom-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .bottom-btn.records {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.3), rgba(68, 160, 141, 0.3));
        }

        .bottom-btn.stats {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
        }

        /* çŠ¶æ…‹è¡¨ç¤º */
        .status-display {
            position: fixed;
            bottom: 2vh;
            left: 50%;
            transform: translateX(-50%);
            padding: 1vh 2vw;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 1vw;
            text-align: center;
            min-width: 30vw;
            z-index: 50;
        }

        .status-text {
            margin: 0;
        }

        /* ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .score-area {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 1.5vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .score-label {
            font-size: 2vw;
            opacity: 0.9;
            margin-bottom: 1vh;
        }

        .score-text {
            font-size: 4vw;
            font-weight: bold;
        }

        .half-score {
            margin-top: 0.8vh;
            font-size: 1.5vw;
            text-align: center;
            opacity: 0.85;
            line-height: 1.4;
        }


        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ */
        .action-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1vw;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
        }

        .action-title {
            text-align: center;
            font-size: 2vw;
            font-weight: bold;
            margin-bottom: 1vh;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1vw;
        }

        .action-main {
            padding: 1vh 0.5vw;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            aspect-ratio: 1 / 1;
            font-size: 1vw;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-main:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .action-main.shoot {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .action-main.seven-m {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .action-main.warning {
            background: linear-gradient(135deg, #ffd89b, #ff9a76);
        }

        .action-main.two-min {
            background: linear-gradient(135deg, #fa709a, #fee140);
        }

        .action-main.expulsion {
            background: linear-gradient(135deg, #30cfd0, #330867);
        }

        /* çŠ¶æ…‹è¡¨ç¤º */
        .status-display {
            margin-top: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 14px;
        }

        .status-text {
            margin-bottom: 5px;
        }

        /* è¨­å®šãƒœã‚¿ãƒ³ */
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            z-index: 100;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆè¨­å®šç”»é¢ãƒ»è¨˜éŒ²è¡¨ç¤ºï¼‰ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(78, 205, 196, 0.5);
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #4ecdc4;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.save {
            background: #4ecdc4;
            color: #1a1a2e;
        }

        .modal-btn.cancel {
            background: #95a5a6;
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-btn.danger {
            background: #ff6b6b;
            color: white;
        }

        /* è¨˜éŒ²ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« */
        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .records-table th,
        .records-table td {
            padding: 10px;
            border: 1px solid rgba(78, 205, 196, 0.3);
            text-align: left;
        }

        .records-table th {
            background: rgba(78, 205, 196, 0.2);
            font-weight: bold;
        }

        .records-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(78, 205, 196, 0.8);
        }

        /* é¸æ‰‹ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  */
        .players-form {
            display: grid;
            grid-template-columns: 60px 1fr 80px;
            gap: 10px;
            margin-bottom: 10px;
        }

        .players-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .delete-btn {
            padding: 6px 12px;
            background: #ff6b6b;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #ff5252;
        }

        /* çµ±è¨ˆè¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(78, 205, 196, 0.3);
        }

        .stat-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4ecdc4;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 14px;
        }

        .stat-value {
            font-size: 14px;
            font-weight: bold;
            color: #4ecdc4;
        }

        /* ã‚°ãƒ©ãƒ•ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4ecdc4;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-label {
            min-width: 100px;
            font-size: 14px;
        }

        .bar-bg {
            flex: 1;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 12px;
            font-weight: bold;
        }

        .bar-value {
            min-width: 40px;
            text-align: right;
            font-size: 14px;
            font-weight: bold;
        }

        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç”¨ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(78, 205, 196, 0.3);
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(78, 205, 196, 0.1);
        }

        .tab-btn.active {
            border-bottom-color: #4ecdc4;
            color: #4ecdc4;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
  <!-- ===== CSSã“ã“ã¾ã§ ===== -->
</head>
<body>

  <!-- ===== HTMLã“ã“ã‹ã‚‰ ===== -->
  
    <!-- ç”»é¢å…¨ä½“ -->
    <div id="app">
    <!-- ãƒ¡ã‚¤ãƒ³è¨˜éŒ²ç”»é¢ -->
    <div class="main-screen screen active" id="mainScreen">
        <!-- è¨­å®šãƒœã‚¿ãƒ³ -->
        <button class="settings-btn" onclick="openSettings()">âš™ï¸ è¨­å®š</button>

        <!-- 1è¡Œç›®ï¼šã‚¿ã‚¤ãƒãƒ¼ã€ã‚¹ã‚³ã‚¢ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="top-row">
            <!-- ã‚¿ã‚¤ãƒãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="timer-area">
                <div class="timer-display" id="timerDisplay">00:00</div>
                <div class="timer-sub" id="timerSub">æ®‹ã‚Š 25:00</div>
                <div class="timer-controls">
                    <button class="timer-btn start" onclick="startTimer()">â–¶</button>
                    <button class="timer-btn pause" onclick="pauseTimer()">â¸</button>
                    <button class="timer-btn reset" onclick="resetTimer()">â¹</button>
                </div>
            <!-- å‰åŠï¼å¾ŒåŠåˆ‡ã‚Šæ›¿ãˆ -->
                <div class="half-switch">
                    <button id="halfBtn" onclick="toggleHalf()">å‰åŠ</button>
                </div>
            </div>

            <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="score-area">
                <div class="score-label">ã‚¹ã‚³ã‚¢</div>
                <div class="score-text" id="scoreDisplay">0 - 0</div>
                
                <!-- å‰åŠãƒ»å¾ŒåŠã‚¹ã‚³ã‚¢ -->
                <div class="half-score">
                    <div>å‰åŠï¼š<span id="firstHalfScore">0 - 0</span></div>
                    <div>å¾ŒåŠï¼š<span id="secondHalfScore">0 - 0</span></div>
                </div>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ -->
            <div class="action-area">
                <div class="action-title">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                <div class="action-buttons">
                    <button class="action-main shoot" onclick="selectAction('shoot')">ã‚·ãƒ¥ãƒ¼ãƒˆ</button>
                    <button class="action-main seven-m" onclick="selectAction('7m')">7m</button>
                    <button class="action-main warning" onclick="selectAction('warning')">è­¦å‘Š</button>
                    <button class="action-main two-min" onclick="selectAction('2min')">2åˆ†é€€å ´</button>
                    <button class="action-main expulsion" onclick="selectAction('expulsion')">è¿½æ”¾</button>
                </div>
            </div>
        </div>

        <!-- 2è¡Œç›®ï¼šã‚´ãƒ¼ãƒ«ã€è‡ªãƒãƒ¼ãƒ ã€ç›¸æ‰‹ãƒãƒ¼ãƒ  -->
        <div class="middle-row">
            <!-- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ -->
            <div class="goal-area">
                <div class="goal-title">ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®</div>
                <div class="goal-grid">
                    <!-- ä¸Šæ®µã®å¤–ãƒœã‚¿ãƒ³ -->
                    <button class="goal-btn corner-tl" onclick="selectGoalLocation('left-top-out')">å·¦ä¸Šå¤–</button>
                    <button class="goal-btn corner-top" onclick="selectGoalLocation('center-top-out')">çœŸä¸Šå¤–</button>
                    <button class="goal-btn corner-tr" onclick="selectGoalLocation('right-top-out')">å³ä¸Šå¤–</button>

                    <!-- å·¦æ¨ªå¤–ï¼ˆç¸¦é•·ï¼‰ -->
                    <button class="goal-btn side-left" onclick="selectGoalLocation('left-side-out')">å·¦æ¨ªå¤–</button>

                    <!-- ã‚´ãƒ¼ãƒ«å†…6åˆ†å‰² -->
                    <div class="goal-inner">
                        <button class="goal-btn" onclick="selectGoalLocation('left-top-in')">å·¦ä¸Š</button>
                        <button class="goal-btn" onclick="selectGoalLocation('center-top-in')">ä¸­ä¸Š</button>
                        <button class="goal-btn" onclick="selectGoalLocation('right-top-in')">å³ä¸Š</button>
                        <button class="goal-btn" onclick="selectGoalLocation('left-bottom-in')">å·¦ä¸‹</button>
                        <button class="goal-btn" onclick="selectGoalLocation('center-bottom-in')">ä¸­ä¸‹</button>
                        <button class="goal-btn" onclick="selectGoalLocation('right-bottom-in')">å³ä¸‹</button>
                    </div>

                    <!-- å³æ¨ªå¤–ï¼ˆç¸¦é•·ï¼‰ -->
                    <button class="goal-btn side-right" onclick="selectGoalLocation('right-side-out')">å³æ¨ªå¤–</button>
                </div>
            </div>

            <!-- è‡ªãƒãƒ¼ãƒ èƒŒç•ªå·ã‚¨ãƒªã‚¢ -->
            <div class="my-team-area">
                <div class="team-title">è‡ªãƒãƒ¼ãƒ </div>
                <div class="player-grid" id="myTeamPlayersGrid">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ç›¸æ‰‹ãƒãƒ¼ãƒ èƒŒç•ªå·ã‚¨ãƒªã‚¢ -->
            <div class="opponent-team-area">
                <div class="team-title">ç›¸æ‰‹ãƒãƒ¼ãƒ </div>
                <div class="player-grid" id="opponentTeamPlayersGrid">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- 3è¡Œç›®ï¼šä¸‹éƒ¨ãƒœã‚¿ãƒ³ -->
        <div class="bottom-row">
            <div class="bottom-buttons">
                <button class="bottom-btn records" onclick="showRecords()">ğŸ“‹ è¨˜éŒ²ã‚’è¡¨ç¤º</button>
                <button class="bottom-btn stats" onclick="showStats()">ğŸ“Š çµ±è¨ˆã‚’è¡¨ç¤º</button>
            </div>
        </div>

        <!-- çŠ¶æ…‹è¡¨ç¤º -->
        <div class="status-display">
            <div class="status-text" id="statusText">å¾…æ©Ÿä¸­...</div>
        </div>
    </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆçµæœé¸æŠãªã©ï¼‰ -->
    <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-title">è©¦åˆè¨­å®š</div>
            
            <div class="form-group">
                <label class="form-label">ãƒãƒ¼ãƒ•ã‚¿ã‚¤ãƒ ï¼ˆåˆ†ï¼‰</label>
                <input type="number" class="form-input" id="halfTimeInput" value="25">
            </div>

            <div class="form-group">
                <label class="form-label">è‡ªãƒãƒ¼ãƒ é¸æ‰‹ç™»éŒ²</label>
                <div class="players-form">
                    <input type="number" class="form-input" id="playerNumber" placeholder="ç•ªå·" min="1" max="99">
                    <input type="text" class="form-input" id="playerName" placeholder="åå‰">
                    <button class="modal-btn save" onclick="addPlayer()">è¿½åŠ </button>
                </div>
                <div class="players-list" id="playersList">
                    <!-- ç™»éŒ²ã•ã‚ŒãŸé¸æ‰‹ä¸€è¦§ -->
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn danger" onclick="resetMatchData()">ğŸ—‘ è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                <button class="modal-btn cancel" onclick="closeSettings()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-btn save" onclick="saveSettings()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- è¨˜éŒ²è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="recordsModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-title">è©¦åˆè¨˜éŒ²ä¸€è¦§</div>
            <table class="records-table">
                <thead>
                    <tr>
                        <th>æ™‚åˆ»</th>
                        <th>ãƒãƒ¼ãƒ </th>
                        <th>é¸æ‰‹</th>
                        <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                        <th>ä½ç½®</th>
                        <th>çµæœ</th>
                    </tr>
                </thead>
                <tbody id="recordsTableBody">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </tbody>
            </table>
            <div class="modal-buttons">
                <button class="modal-btn save" onclick="exportRecords()">ğŸ“¥ CSVå‡ºåŠ›</button>
                <button class="modal-btn cancel" onclick="closeRecords()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- çµ±è¨ˆè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="statsModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-title">è©¦åˆçµ±è¨ˆ</div>
            
            <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('summary')">è©¦åˆã‚µãƒãƒªãƒ¼</button>
                <button class="tab-btn" onclick="switchTab('player')">é¸æ‰‹åˆ¥çµ±è¨ˆ</button>
                <button class="tab-btn" onclick="switchTab('keeper')">ã‚­ãƒ¼ãƒ‘ãƒ¼åˆ†æ</button>
            </div>

            <!-- è©¦åˆã‚µãƒãƒªãƒ¼ã‚¿ãƒ– -->
            <div class="tab-content active" id="summaryTab">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-title">è‡ªãƒãƒ¼ãƒ </div>
                        <div id="myTeamSummary"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ç›¸æ‰‹ãƒãƒ¼ãƒ </div>
                        <div id="opponentTeamSummary"></div>
                    </div>
                </div>
            </div>

            <!-- é¸æ‰‹åˆ¥çµ±è¨ˆã‚¿ãƒ– -->
            <div class="tab-content" id="playerTab">
                <div class="chart-container">
                    <div class="chart-title">è‡ªãƒãƒ¼ãƒ  - é¸æ‰‹åˆ¥å¾—ç‚¹</div>
                    <div class="bar-chart" id="myTeamPlayerStats"></div>
                </div>
                <div class="chart-container" style="margin-top: 20px;">
                    <div class="chart-title">è‡ªãƒãƒ¼ãƒ  - é¸æ‰‹åˆ¥ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡</div>
                    <div class="bar-chart" id="myTeamShootStats"></div>
                </div>
            </div>

            <!-- ã‚­ãƒ¼ãƒ‘ãƒ¼åˆ†æã‚¿ãƒ– -->
            <div class="tab-content" id="keeperTab">
                <div class="chart-container">
                    <div class="chart-title">ç›¸æ‰‹ã‚­ãƒ¼ãƒ‘ãƒ¼ - ã‚¨ãƒªã‚¢åˆ¥ã‚»ãƒ¼ãƒ–ç‡</div>
                    <div class="bar-chart" id="keeperAreaStats"></div>
                </div>
                <div class="chart-container" style="margin-top: 20px;">
                    <div class="chart-title">ç›¸æ‰‹ã‚­ãƒ¼ãƒ‘ãƒ¼ - å¼±ç‚¹åˆ†æ</div>
                    <div id="keeperAnalysis"></div>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeStats()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ã‚·ãƒ¥ãƒ¼ãƒˆçµæœé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="resultModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-title">ã‚·ãƒ¥ãƒ¼ãƒˆçµæœã‚’é¸æŠ</div>
            <div style="display: flex; flex-direction: row; gap: 15px; margin-top: 30px;">
                <button class="action-btn result-goal" onclick="selectResult('goal')">
                    <div>âš½</div>
                    <div id="resultGoalText">å…¥ã£ãŸ</div>
                </button>

                <button class="action-btn result-saved" onclick="selectResult('saved')">
                    <div>ğŸ§¤</div>
                    <div id="resultSavedText">æ­¢ã‚ã‚‰ã‚ŒãŸ</div>
                </button>

                <button class="action-btn result-miss" onclick="selectResult('miss')">
                    <div>âŒ</div>
                    <div>å¤–ã—ãŸ</div>
                </button>

            </div>
            <div class="modal-buttons" style="margin-top: 30px;">
                <button class="modal-btn cancel" onclick="closeResultModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

  <!-- ===== JavaScriptã“ã“ã‹ã‚‰ ===== -->
    <script>
        // ========================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®å®šç¾©
        // ========================================
        
        let myTeamPlayers = [];

        // ã‚¿ã‚¤ãƒãƒ¼é–¢é€£ã®å¤‰æ•°
        let timerSeconds = 0;           // çµŒéæ™‚é–“ï¼ˆç§’ï¼‰
        let timerInterval = null;       // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID
        let isTimerRunning = false;     // ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ä½œä¸­ã‹ã©ã†ã‹
        let halfTime = 25;              // ãƒãƒ¼ãƒ•ã‚¿ã‚¤ãƒ ã®é•·ã•ï¼ˆåˆ†ï¼‰
        let currentHalf = 1;            // 1 = å‰åŠ, 2 = å¾ŒåŠ


        // è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—
        let records = [];

        // ç¾åœ¨ã®å…¥åŠ›çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¤‰æ•°
        let currentAction = null;       // ç¾åœ¨é¸æŠä¸­ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆshoot, 7m, warning, 2min, expulsionï¼‰
        let currentTeam = null;         // ç¾åœ¨é¸æŠä¸­ã®ãƒãƒ¼ãƒ ï¼ˆmy, opponentï¼‰
        let currentPlayer = null;       // ç¾åœ¨é¸æŠä¸­ã®é¸æ‰‹ç•ªå·
        let currentLocation = null;     // ç¾åœ¨é¸æŠä¸­ã®ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®


        // ç›¸æ‰‹ãƒãƒ¼ãƒ ã®èƒŒç•ªå·ï¼ˆ1-20ï¼‰
        let opponentNumbers = Array.from({length: 20}, (_, i) => i + 1);

        // ========================================
        // åˆæœŸåŒ–å‡¦ç†
        // ========================================

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.onload = function() {
            // LocalStorageã‹ã‚‰ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadFromLocalStorage();
            // â˜…å¿…ãšé…åˆ—ã«çŸ¯æ­£ï¼ˆã“ã“ãŒé‡è¦ï¼‰
            if (!Array.isArray(myTeamPlayers)) {
                console.warn("onloadæ™‚ã«myTeamPlayersã‚’çŸ¯æ­£:", myTeamPlayers);
                myTeamPlayers = [];
            }
            // ç”»é¢ã«é¸æ‰‹ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            renderPlayers();
            // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚’æ›´æ–°
            updateTimerDisplay();
            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
            updateScoreDisplay();
        };

        // ========================================
        // ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
        // ========================================

        // ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã™ã‚‹
        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                // 1ç§’ã”ã¨ã«timerTickã‚’å®Ÿè¡Œ
                timerInterval = setInterval(timerTick, 1000);
                // ã‚¿ã‚¤ãƒãƒ¼ä½œå‹•ä¸­ã¯ãƒãƒ¼ãƒ•ã‚¿ã‚¤ãƒ ãƒœã‚¿ãƒ³ã‚’åœæ­¢
                document.getElementById('halfBtn').disabled = true;

            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹
        function pauseTimer() {
            isTimerRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                // ä¸€æ™‚åœæ­¢ä¸­ã«ã¯ãƒãƒ¼ãƒ•ã‚¿ã‚¤ãƒ ãƒœã‚¿ãƒ³ä½¿ç”¨å¯
                document.getElementById('halfBtn').disabled = false;
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ï¼ˆ0ã«æˆ»ã™ï¼‰
        function resetTimer() {
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
            // ä¸€æ™‚åœæ­¢ä¸­ã«ã¯ãƒãƒ¼ãƒ•ã‚¿ã‚¤ãƒ ãƒœã‚¿ãƒ³ä½¿ç”¨å¯
            document.getElementById('halfBtn').disabled = false;
        }

        // ã‚¿ã‚¤ãƒãƒ¼ã®1ç§’ã”ã¨ã®å‡¦ç†
        function timerTick() {
            timerSeconds++;
            updateTimerDisplay();
        }

        // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
        function updateTimerDisplay() {
            // çµŒéæ™‚é–“ã‚’åˆ†:ç§’ã®å½¢å¼ã«å¤‰æ›
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;

            // æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—
            const remainingSeconds = (halfTime * 60) - timerSeconds;
            const remainingMinutes = Math.floor(remainingSeconds / 60);
            const remainingSecs = remainingSeconds % 60;
            const remainingString = remainingSeconds >= 0 
                ? `æ®‹ã‚Š ${String(remainingMinutes).padStart(2, '0')}:${String(remainingSecs).padStart(2, '0')}`
                : 'å»¶é•·ä¸­';
            document.getElementById('timerSub').textContent = remainingString;
        }

        //ã€€å‰å¾ŒåŠã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleHalf() {
            // å‰åŠ â†’ å¾ŒåŠ ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ãã ã‘ç¢ºèª
            if (currentHalf === 1) {
                const ok = confirm("å‰åŠã‚’çµ‚äº†ã—ã¦å¾ŒåŠã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚\nã‚¿ã‚¤ãƒãƒ¼ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ");

                if (!ok) return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‚‰ä½•ã‚‚ã—ãªã„
            }

            //ã€€åˆ‡ã‚Šæ›¿ãˆ
            currentHalf = currentHalf === 1 ? 2 : 1;

            const btn = document.getElementById('halfBtn');

            if (currentHalf === 1) {
                btn.textContent = 'å‰åŠ';
                btn.classList.remove('second');
            } else {
                btn.textContent = 'å¾ŒåŠ';
                btn.classList.add('second');

                // â˜… å¾ŒåŠã«å…¥ã£ãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ
                resetTimer();
            }
        }


        // ========================================
        // é¸æ‰‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤º
        // ========================================

        // é¸æ‰‹ãƒœã‚¿ãƒ³ã‚’HTMLã«æç”»ã™ã‚‹
        function renderPlayers() {
            // â˜…ä¿é™ºï¼šã“ã“ã§ã‚‚é…åˆ—ãƒã‚§ãƒƒã‚¯
            if (!Array.isArray(myTeamPlayers)) {
                console.warn("renderPlayerså†…ã§çŸ¯æ­£:", myTeamPlayers);
                myTeamPlayers = [];
            }

            // è‡ªãƒãƒ¼ãƒ ã®é¸æ‰‹ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
            const myTeamContainer = document.getElementById('myTeamPlayersGrid');
            myTeamContainer.innerHTML = '';
            


            // 1ã€œ20ç•ªã‚’å¿…ãšç”Ÿæˆ
            for (let num = 1; num <= 20; num++) {

                // ç™»éŒ²æ¸ˆã¿é¸æ‰‹ã‚’æ¢ã™
                const player = myTeamPlayers.find(p => p.number === num);

                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.onclick = () => selectPlayer('my', num);

                btn.innerHTML = `
                    <div class="player-number">#${num}</div>
                    <div class="player-name">
                        ${player ? player.name + (player.isGK ? ' (GK)' : '') : ''}
                    </div>
            `;  

                // æœªç™»éŒ²ç•ªå·ãªã‚‰è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹ï¼ˆä»»æ„ï¼‰
                if (!player) {
                    btn.classList.add('empty');
                }

                    myTeamContainer.appendChild(btn);
            }

            // ç›¸æ‰‹ãƒãƒ¼ãƒ ã®èƒŒç•ªå·ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆï¼ˆ1-10ãŒå·¦åˆ—ã€11-20ãŒå³åˆ—ï¼‰
            const opponentContainer = document.getElementById('opponentTeamPlayersGrid');
            opponentContainer.innerHTML = '';
            
            // 1-10ç•ª
            opponentNumbers.filter(n => n <= 10).forEach(num => {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.onclick = () => selectPlayer('opponent', num);
                btn.innerHTML = `<div class="player-number">#${num}</div>`;
                opponentContainer.appendChild(btn);
            });
            
            // 11-20ç•ª
            opponentNumbers.filter(n => n >= 11).forEach(num => {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.onclick = () => selectPlayer('opponent', num);
                btn.innerHTML = `<div class="player-number">#${num}</div>`;
                opponentContainer.appendChild(btn);
            });
        }   

        // ========================================
        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ
        // ========================================

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
        function selectAction(action) {
            currentAction = action;
            // é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
            currentTeam = null;
            currentPlayer = null;
            currentLocation = null;
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
            updateStatus(`${getActionName(action)}ã‚’é¸æŠ â†’ é¸æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„`);
        }

        // ========================================
        // é¸æ‰‹é¸æŠ
        // ========================================

        // é¸æ‰‹ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
        function selectPlayer(team, playerNumber) {
            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (!currentAction) {
                updateStatus('å…ˆã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            currentTeam = team;
            currentPlayer = playerNumber;

            // é¸æ‰‹ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
            document.querySelectorAll('.player-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.player-btn').classList.add('selected');

            // ã‚·ãƒ¥ãƒ¼ãƒˆã¾ãŸã¯7mã®å ´åˆã¯ã‚´ãƒ¼ãƒ«ä½ç½®ã®é¸æŠã¸
            if (currentAction === 'shoot' || currentAction === '7m') {
                updateStatus(`${getTeamName(team)} #${playerNumber} â†’ ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ã‚’é¸ã‚“ã§ãã ã•ã„`);
            } else {
                // è­¦å‘Šãƒ»é€€å ´ç³»ã¯ã“ã“ã§è¨˜éŒ²å®Œäº†
                recordEvent(null);
            }
        }

        // ========================================
        // ã‚´ãƒ¼ãƒ«ä½ç½®é¸æŠ
        // ========================================

        // ã‚´ãƒ¼ãƒ«ä½ç½®ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
        function selectGoalLocation(location) {
            // ã‚·ãƒ¥ãƒ¼ãƒˆç³»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨é¸æ‰‹ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
            if ((currentAction !== 'shoot' && currentAction !== '7m') || !currentPlayer) {
                updateStatus('ã‚·ãƒ¥ãƒ¼ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨é¸æ‰‹ã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            currentLocation = location;

            // ã‚´ãƒ¼ãƒ«å†…ã®ä½ç½®ãªã‚‰ã€Œå…¥ã£ãŸãƒ»æ­¢ã‚ã‚‰ã‚ŒãŸã€ã‚’é¸æŠ
            if (location.endsWith('-in')) {
                showResultSelection();
            } else {
                // ã‚´ãƒ¼ãƒ«å¤–ãªã‚‰ã€Œå¤–ã—ãŸã€ã¨ã—ã¦è¨˜éŒ²
                recordEvent('miss');
            }
        }

        // ========================================
        // ã‚·ãƒ¥ãƒ¼ãƒˆçµæœé¸æŠ
        // ========================================

        // ã‚·ãƒ¥ãƒ¼ãƒˆçµæœã‚’é¸æŠã™ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        function showResultSelection() {
            // ãƒãƒ¼ãƒ ã«ã‚ˆã£ã¦ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´
            const goalText = document.getElementById('resultGoalText');
            const savedText = document.getElementById('resultSavedText');
            
            if (currentTeam === 'my') {
                // è‡ªãƒãƒ¼ãƒ ã®å ´åˆ
                goalText.textContent = 'å…¥ã£ãŸ';
                savedText.textContent = 'æ­¢ã‚ã‚‰ã‚ŒãŸ';
            } else {
                // ç›¸æ‰‹ãƒãƒ¼ãƒ ã®å ´åˆ
                goalText.textContent = 'å…¥ã‚Œã‚‰ã‚ŒãŸ';
                savedText.textContent = 'æ­¢ã‚ãŸ';
            }
            
            document.getElementById('resultModal').classList.add('active');
        }

        // ã‚·ãƒ¥ãƒ¼ãƒˆçµæœãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeResultModal() {
            document.getElementById('resultModal').classList.remove('active');
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ãŸã‚‰é¸æŠçŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ
            resetSelection();
        }

        // ã‚·ãƒ¥ãƒ¼ãƒˆçµæœãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†
        function selectResult(result) {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.getElementById('resultModal').classList.remove('active');
            // è¨˜éŒ²ã‚’ä¿å­˜
            recordEvent(result);
        }

        // ========================================
        // è¨˜éŒ²ã®ä¿å­˜
        // ========================================

        // ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨˜éŒ²é…åˆ—ã«è¿½åŠ ã™ã‚‹
        function recordEvent(result) {
            // ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
            const currentTime = getCurrentTimeString();

            // è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
            const record = {
                time: currentTime,              // è©¦åˆæ™‚åˆ»
                team: currentTeam,              // my or opponent
                playerNumber: currentPlayer,    // é¸æ‰‹ç•ªå·
                action: currentAction,          // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥
                location: currentLocation,      // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ï¼ˆã‚·ãƒ¥ãƒ¼ãƒˆç³»ã®ã¿ï¼‰
                result: result,                  // ã‚·ãƒ¥ãƒ¼ãƒˆçµæœï¼ˆgoal, saved, missï¼‰
                half: currentHalf               // â˜… å‰åŠ:1 / å¾ŒåŠ:2
            };

            // è¨˜éŒ²é…åˆ—ã«è¿½åŠ 
            records.push(record);

            // LocalStorageã«ä¿å­˜
            saveToLocalStorage();

            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
            updateScoreDisplay();

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
            updateStatus(`è¨˜éŒ²ã—ã¾ã—ãŸ: ${formatRecord(record)}`);

            // é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
            resetSelection();
        }

        // ========================================
        // ã‚¹ã‚³ã‚¢è¨ˆç®—ã¨è¡¨ç¤º
        // ========================================

        // ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤ºã‚’æ›´æ–°

        function updateScoreDisplay() {
            let myFirst = 0;
            let oppFirst = 0;
            let mySecond = 0;
            let oppSecond = 0;

            records.forEach(record => {
                if (record.result === 'goal') {
                    if (record.half === 1) {
                        if (record.team === 'my') myFirst++;
                        if (record.team === 'opponent') oppFirst++;
                    } else if (record.half === 2) {
                        if (record.team === 'my') mySecond++;
                        if (record.team === 'opponent') oppSecond++;
                    }
                }
            });

            // åˆè¨ˆ
            const myTotal = myFirst + mySecond;
            const oppTotal = oppFirst + oppSecond;

            // è¡¨ç¤ºæ›´æ–°
            document.getElementById('scoreDisplay').textContent = `${myTotal} - ${oppTotal}`;

            document.getElementById('firstHalfScore').textContent = `${myFirst} - ${oppFirst}`;

            document.getElementById('secondHalfScore').textContent = `${mySecond} - ${oppSecond}`;
        }
 
        // ========================================
        // çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
        // ========================================

        // é¸æŠçŠ¶æ…‹ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã™ã‚‹
        function resetSelection() {
            currentAction = null;
            currentTeam = null;
            currentPlayer = null;
            currentLocation = null;

            // é¸æ‰‹ãƒœã‚¿ãƒ³ã®é¸æŠè¡¨ç¤ºã‚’è§£é™¤
            document.querySelectorAll('.player-btn').forEach(btn => btn.classList.remove('selected'));
        }

        // ========================================
        // è©¦åˆãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚»ãƒƒãƒˆ
        // ========================================

        function resetMatchData() {
            const ok = confirm(
                "ã“ã®è©¦åˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚\n" +
                "ï¼ˆå¾—ç‚¹ãƒ»è¨˜éŒ²ãƒ»çµ±è¨ˆãƒ»ã‚¿ã‚¤ãƒãƒ¼ï¼‰\n" +
                "â€»è‡ªãƒãƒ¼ãƒ é¸æ‰‹ã¨è©¦åˆæ™‚é–“è¨­å®šã¯æ®‹ã‚Šã¾ã™ã€‚\n\n" +
                "ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
            );
            if (!ok) return;

            // è‡ªãƒãƒ¼ãƒ é¸æ‰‹ã‚’é€€é¿
            const savedPlayers = myTeamPlayers;
            const savedHalfTime = halfTime;

            // è©¦åˆç³»ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            records = [];
            timerSeconds = 0;
            currentHalf = 1;

            //é€€é¿ã—ãŸè¨­å®šã‚’æˆ»ã™
            myTeamPlayers = savedPlayers;
            halfTime = savedHalfTime;

            // è¨­å®šç”»é¢ã®å…¥åŠ›æ¬„ã‚‚æˆ»ã™ï¼ˆé–‹ã„ã¦ã„ã‚‹/ã„ãªã„ã«é–¢ä¿‚ãªãæ•´åˆãŒå–ã‚Œã‚‹ï¼‰
            const halfInput = document.getElementById("halfTimeInput");
            if (halfInput) halfInput.value = String(savedHalfTime);

            // å‰åŠ/å¾ŒåŠãƒœã‚¿ãƒ³è¡¨ç¤ºã‚’å‰åŠã«æˆ»ã™
            const halfBtn = document.getElementById("halfBtn");
            if (halfBtn) {
                halfBtn.textContent = "å‰åŠ";
                halfBtn.classList.remove("second");
                halfBtn.disabled = false; // ãƒªã‚»ãƒƒãƒˆç›´å¾Œã¯åˆ‡æ›¿å¯ã«
            }

            // è¡¨ç¤ºåˆæœŸåŒ–
            resetSelection?.();
            resetTimer?.();
            updateScoreDisplay?.();
            updateStatus?.("è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");

            // LocalStorageã¸å†ä¿å­˜
            saveToLocalStorage();

            // é¸æ‰‹UIã‚’å†æç”»ï¼ˆå¿…è¦ãªã‚‰ï¼‰
            renderPlayers?.();
        }

        // ========================================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        // ========================================

        // ç¾åœ¨ã®ã‚¿ã‚¤ãƒãƒ¼æ™‚åˆ»ã‚’æ–‡å­—åˆ—ã§è¿”ã™
        function getCurrentTimeString() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åã‚’æ—¥æœ¬èªã«å¤‰æ›
        function getActionName(action) {
            const names = {
                'shoot': 'ã‚·ãƒ¥ãƒ¼ãƒˆ',
                '7m': '7mã‚¹ãƒ­ãƒ¼',
                'warning': 'è­¦å‘Š',
                '2min': '2åˆ†é–“é€€å ´',
                'expulsion': 'è¿½æ”¾'
            };
            return names[action] || action;
        }

        // ãƒãƒ¼ãƒ åã‚’æ—¥æœ¬èªã«å¤‰æ›
        function getTeamName(team) {
            return team === 'my' ? 'è‡ªãƒãƒ¼ãƒ ' : 'ç›¸æ‰‹ãƒãƒ¼ãƒ ';
        }

        // ã‚´ãƒ¼ãƒ«ä½ç½®åã‚’æ—¥æœ¬èªã«å¤‰æ›
        function getLocationName(location) {
            const names = {
                'left-top-out': 'å·¦ä¸Šå¤–',
                'center-top-out': 'çœŸä¸Šå¤–',
                'right-top-out': 'å³ä¸Šå¤–',
                'left-side-out': 'å·¦æ¨ªå¤–',
                'right-side-out': 'å³æ¨ªå¤–',
                'left-top-in': 'å·¦ä¸Š',
                'center-top-in': 'ä¸­ä¸Š',
                'right-top-in': 'å³ä¸Š',
                'left-bottom-in': 'å·¦ä¸‹',
                'center-bottom-in': 'ä¸­ä¸‹',
                'right-bottom-in': 'å³ä¸‹'
            };
            return names[location] || location;
        }

        // ã‚·ãƒ¥ãƒ¼ãƒˆçµæœã‚’æ—¥æœ¬èªã«å¤‰æ›
        function getResultName(result) {
            const names = {
                'goal': 'å…¥ã£ãŸ',
                'saved': 'æ­¢ã‚ã‚‰ã‚ŒãŸ',
                'miss': 'å¤–ã—ãŸ'
            };
            return names[result] || result;
        }

        // è¨˜éŒ²ã‚’èª­ã¿ã‚„ã™ã„æ–‡å­—åˆ—ã«æ•´å½¢
        function formatRecord(record) {
            let text = `${record.time} ${getTeamName(record.team)} #${record.playerNumber} ${getActionName(record.action)}`;
            if (record.location) {
                text += ` (${getLocationName(record.location)})`;
            }
            if (record.result) {
                text += ` â†’ ${getResultName(record.result)}`;
            }
            return text;
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
        }

        // ========================================
        // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
        // ========================================

        // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('halfTimeInput').value = halfTime;
            renderPlayersList();
        }

        // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // è¨­å®šã‚’ä¿å­˜
        function saveSettings() {
            halfTime = parseInt(document.getElementById('halfTimeInput').value);
            saveToLocalStorage();
            updateTimerDisplay();
            renderPlayers();
            closeSettings();
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        }

        // é¸æ‰‹ã‚’è¿½åŠ 
        function addPlayer() {
            const number = parseInt(document.getElementById('playerNumber').value);
            const name = document.getElementById('playerName').value.trim();

            if (!number || !name) {
                alert('ç•ªå·ã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (myTeamPlayers.some(p => p.number === number)) {
                alert('ã“ã®ç•ªå·ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
                return;
            }

            // é¸æ‰‹ã‚’è¿½åŠ 
            myTeamPlayers.push({
                number: number,
                name: name,
                isGK: (number === 1 || number === 12)  // 1ç•ªã¨12ç•ªã¯è‡ªå‹•çš„ã«GK
            });

            // ç•ªå·é †ã«ã‚½ãƒ¼ãƒˆ
            myTeamPlayers.sort((a, b) => a.number - b.number);

            // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('playerNumber').value = '';
            document.getElementById('playerName').value = '';

            // ä¸€è¦§ã‚’å†æç”»
            renderPlayersList();
        }

        // é¸æ‰‹ä¸€è¦§ã‚’æç”»
        function renderPlayersList() {
            const container = document.getElementById('playersList');
            container.innerHTML = '';

            myTeamPlayers.forEach(player => {
                const item = document.createElement('div');
                item.className = 'player-item';
                item.innerHTML = `
                    <span>#${player.number} ${player.name}${player.isGK ? ' (GK)' : ''}</span>
                    <button class="delete-btn" onclick="deletePlayer(${player.number})">å‰Šé™¤</button>
                `;
                container.appendChild(item);
            });
        }

        // é¸æ‰‹ã‚’å‰Šé™¤
        function deletePlayer(number) {
            if (confirm('ã“ã®é¸æ‰‹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                myTeamPlayers = myTeamPlayers.filter(p => p.number !== number);
                renderPlayersList();
            }
        }

        // ========================================
        // çµ±è¨ˆè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«
        // ========================================

        // çµ±è¨ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        function showStats() {
            document.getElementById('statsModal').classList.add('active');
            calculateStats();
        }

        // çµ±è¨ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeStats() {
            document.getElementById('statsModal').classList.remove('active');
        }

        // ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // çµ±è¨ˆã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
        function calculateStats() {
            calculateTeamSummary();
            calculatePlayerStats();
            calculateKeeperStats();
        }

        // ãƒãƒ¼ãƒ ã‚µãƒãƒªãƒ¼ã‚’è¨ˆç®—
        function calculateTeamSummary() {
            const teams = ['my', 'opponent'];
            
            teams.forEach(team => {
                const teamRecords = records.filter(r => r.team === team);
                
                // ã‚·ãƒ¥ãƒ¼ãƒˆç³»ã®è¨˜éŒ²ã®ã¿ã‚’æŠ½å‡º
                const shootRecords = teamRecords.filter(r => 
                    (r.action === 'shoot' || r.action === '7m') && r.result
                );
                
                const goals = shootRecords.filter(r => r.result === 'goal').length;
                const saved = shootRecords.filter(r => r.result === 'saved').length;
                const miss = shootRecords.filter(r => r.result === 'miss').length;
                const totalShots = goals + saved + miss;
                const successRate = totalShots > 0 ? Math.round((goals / totalShots) * 100) : 0;
                
                const warnings = teamRecords.filter(r => r.action === 'warning').length;
                const twoMins = teamRecords.filter(r => r.action === '2min').length;
                const expulsions = teamRecords.filter(r => r.action === 'expulsion').length;

                const html = `
                    <div class="stat-item">
                        <span class="stat-label">å¾—ç‚¹</span>
                        <span class="stat-value">${goals}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ã‚·ãƒ¥ãƒ¼ãƒˆæ•°</span>
                        <span class="stat-value">${totalShots}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æˆåŠŸç‡</span>
                        <span class="stat-value">${successRate}%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è­¦å‘Š</span>
                        <span class="stat-value">${warnings}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">2åˆ†é€€å ´</span>
                        <span class="stat-value">${twoMins}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è¿½æ”¾</span>
                        <span class="stat-value">${expulsions}</span>
                    </div>
                `;

                const containerId = team === 'my' ? 'myTeamSummary' : 'opponentTeamSummary';
                document.getElementById(containerId).innerHTML = html;
            });
        }

        // é¸æ‰‹åˆ¥çµ±è¨ˆã‚’è¨ˆç®—
        function calculatePlayerStats() {
            // è‡ªãƒãƒ¼ãƒ ã®é¸æ‰‹åˆ¥å¾—ç‚¹ã‚’é›†è¨ˆ
            const playerGoals = {};
            const playerShots = {};
            
            myTeamPlayers.forEach(player => {
                playerGoals[player.number] = 0;
                playerShots[player.number] = {goals: 0, total: 0};
            });

            records.forEach(record => {
                if (record.team === 'my' && (record.action === 'shoot' || record.action === '7m')) {
                    if (playerShots[record.playerNumber]) {
                        playerShots[record.playerNumber].total++;
                        if (record.result === 'goal') {
                            playerGoals[record.playerNumber]++;
                            playerShots[record.playerNumber].goals++;
                        }
                    }
                }
            });

            // å¾—ç‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå¾—ç‚¹ãŒå¤šã„é †ï¼‰
            const sortedByGoals = Object.entries(playerGoals)
                .filter(([num, goals]) => goals > 0)
                .sort((a, b) => b[1] - a[1]);

            let goalsHtml = '';
            if (sortedByGoals.length === 0) {
                goalsHtml = '<div class="stat-item"><span class="stat-label">ã¾ã å¾—ç‚¹ãŒã‚ã‚Šã¾ã›ã‚“</span></div>';
            } else {
                sortedByGoals.forEach(([playerNum, goals]) => {
                    const player = myTeamPlayers.find(p => p.number == playerNum);
                    const name = player ? player.name : `#${playerNum}`;
                    goalsHtml += `
                        <div class="bar-item">
                            <div class="bar-label">${name}</div>
                            <div class="bar-bg">
                                <div class="bar-fill" style="width: ${(goals / sortedByGoals[0][1]) * 100}%">
                                    ${goals}ç‚¹
                                </div>
                            </div>
                            <div class="bar-value">${goals}</div>
                        </div>
                    `;
                });
            }
            document.getElementById('myTeamPlayerStats').innerHTML = goalsHtml;

            // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ï¼ˆã‚·ãƒ¥ãƒ¼ãƒˆæ•°ãŒ3æœ¬ä»¥ä¸Šã®é¸æ‰‹ã®ã¿ï¼‰
            const sortedByRate = Object.entries(playerShots)
                .filter(([num, data]) => data.total >= 3)
                .map(([num, data]) => {
                    const rate = Math.round((data.goals / data.total) * 100);
                    return [num, rate, data.total, data.goals];
                })
                .sort((a, b) => b[1] - a[1]);

            let rateHtml = '';
            if (sortedByRate.length === 0) {
                rateHtml = '<div class="stat-item"><span class="stat-label">ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆ3æœ¬ä»¥ä¸Šã®ã‚·ãƒ¥ãƒ¼ãƒˆãŒå¿…è¦ï¼‰</span></div>';
            } else {
                sortedByRate.forEach(([playerNum, rate, total, goals]) => {
                    const player = myTeamPlayers.find(p => p.number == playerNum);
                    const name = player ? player.name : `#${playerNum}`;
                    rateHtml += `
                        <div class="bar-item">
                            <div class="bar-label">${name}</div>
                            <div class="bar-bg">
                                <div class="bar-fill" style="width: ${rate}%">
                                    ${rate}%
                                </div>
                            </div>
                            <div class="bar-value">${goals}/${total}</div>
                        </div>
                    `;
                });
            }
            document.getElementById('myTeamShootStats').innerHTML = rateHtml;
        }

        // ã‚­ãƒ¼ãƒ‘ãƒ¼çµ±è¨ˆã‚’è¨ˆç®—
        function calculateKeeperStats() {
            // è‡ªãƒãƒ¼ãƒ ã®ã‚·ãƒ¥ãƒ¼ãƒˆã«å¯¾ã™ã‚‹ç›¸æ‰‹ã‚­ãƒ¼ãƒ‘ãƒ¼ã®ã‚»ãƒ¼ãƒ–ç‡ã‚’ã‚¨ãƒªã‚¢åˆ¥ã«é›†è¨ˆ
            const areaStats = {};
            
            // ã™ã¹ã¦ã®ã‚´ãƒ¼ãƒ«ä½ç½®ã‚’åˆæœŸåŒ–
            const locations = [
                'left-top-in', 'center-top-in', 'right-top-in',
                'left-bottom-in', 'center-bottom-in', 'right-bottom-in'
            ];
            
            locations.forEach(loc => {
                areaStats[loc] = {saved: 0, goal: 0, total: 0};
            });

            // è‡ªãƒãƒ¼ãƒ ã®ã‚·ãƒ¥ãƒ¼ãƒˆï¼ˆã‚´ãƒ¼ãƒ«å†…ï¼‰ã‚’é›†è¨ˆ
            records.forEach(record => {
                if (record.team === 'my' && 
                    (record.action === 'shoot' || record.action === '7m') &&
                    record.location && record.location.endsWith('-in')) {
                    
                    areaStats[record.location].total++;
                    if (record.result === 'saved') {
                        areaStats[record.location].saved++;
                    } else if (record.result === 'goal') {
                        areaStats[record.location].goal++;
                    }
                }
            });

            // ã‚»ãƒ¼ãƒ–ç‡ã®é«˜ã„é †ã«ã‚½ãƒ¼ãƒˆ
            const sortedAreas = Object.entries(areaStats)
                .filter(([loc, data]) => data.total > 0)
                .map(([loc, data]) => {
                    const saveRate = Math.round((data.saved / data.total) * 100);
                    return [loc, saveRate, data.saved, data.total];
                })
                .sort((a, b) => b[1] - a[1]);

            let areaHtml = '';
            if (sortedAreas.length === 0) {
                areaHtml = '<div class="stat-item"><span class="stat-label">ã‚´ãƒ¼ãƒ«å†…ã¸ã®ã‚·ãƒ¥ãƒ¼ãƒˆãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</span></div>';
            } else {
                sortedAreas.forEach(([location, rate, saved, total]) => {
                    areaHtml += `
                        <div class="bar-item">
                            <div class="bar-label">${getLocationName(location)}</div>
                            <div class="bar-bg">
                                <div class="bar-fill" style="width: ${rate}%; background: linear-gradient(90deg, #ff6b6b, #ee5a6f);">
                                    ${rate}%
                                </div>
                            </div>
                            <div class="bar-value">${saved}/${total}</div>
                        </div>
                    `;
                });
            }
            document.getElementById('keeperAreaStats').innerHTML = areaHtml;

            // å¼±ç‚¹åˆ†æï¼ˆã‚»ãƒ¼ãƒ–ç‡ã®ä½ã„ã‚¨ãƒªã‚¢ = ç‹™ã„ç›®ï¼‰
            let analysisHtml = '';
            if (sortedAreas.length > 0) {
                const weakSpots = sortedAreas.filter(([loc, rate]) => rate < 50);
                
                if (weakSpots.length > 0) {
                    analysisHtml += '<div class="stat-card" style="margin: 0;">';
                    analysisHtml += '<div class="stat-title" style="color: #4ecdc4;">ğŸ¯ ç‹™ã„ç›®ã‚¨ãƒªã‚¢ï¼ˆã‚»ãƒ¼ãƒ–ç‡50%æœªæº€ï¼‰</div>';
                    weakSpots.forEach(([location, rate, saved, total]) => {
                        analysisHtml += `
                            <div class="stat-item">
                                <span class="stat-label">${getLocationName(location)}</span>
                                <span class="stat-value">${rate}%ï¼ˆ${saved}/${total}ï¼‰</span>
                            </div>
                        `;
                    });
                    analysisHtml += '</div>';
                } else {
                    analysisHtml += '<div class="stat-item"><span class="stat-label">ç›¸æ‰‹ã‚­ãƒ¼ãƒ‘ãƒ¼ã®å¼±ç‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆå…¨ã‚¨ãƒªã‚¢50%ä»¥ä¸Šã®ã‚»ãƒ¼ãƒ–ç‡ï¼‰</span></div>';
                }

                // æœ€ã‚‚å¾—ç‚¹ã—ã‚„ã™ã„ã‚¨ãƒªã‚¢
                const bestArea = sortedAreas[sortedAreas.length - 1];
                analysisHtml += '<div class="stat-card" style="margin-top: 15px;">';
                analysisHtml += '<div class="stat-title" style="color: #4ecdc4;">âœ¨ æœ€ã‚‚å¾—ç‚¹ã—ã‚„ã™ã„ã‚¨ãƒªã‚¢</div>';
                analysisHtml += `
                    <div class="stat-item">
                        <span class="stat-label">${getLocationName(bestArea[0])}</span>
                        <span class="stat-value">ã‚»ãƒ¼ãƒ–ç‡ ${bestArea[1]}%</span>
                    </div>
                `;
                analysisHtml += '</div>';
            } else {
                analysisHtml = '<div class="stat-item"><span class="stat-label">ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™</span></div>';
            }
            
            document.getElementById('keeperAnalysis').innerHTML = analysisHtml;
        }

        // ========================================
        // è¨˜éŒ²è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«
        // ========================================

        // è¨˜éŒ²ä¸€è¦§ã‚’è¡¨ç¤º
        function showRecords() {
            document.getElementById('recordsModal').classList.add('active');
            renderRecordsTable();
        }

        // è¨˜éŒ²ä¸€è¦§ã‚’é–‰ã˜ã‚‹
        function closeRecords() {
            document.getElementById('recordsModal').classList.remove('active');
        }

        // è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æç”»
        function renderRecordsTable() {
            const tbody = document.getElementById('recordsTableBody');
            tbody.innerHTML = '';

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            records.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.time}</td>
                    <td>${getTeamName(record.team)}</td>
                    <td>#${record.playerNumber}</td>
                    <td>${getActionName(record.action)}</td>
                    <td>${record.location ? getLocationName(record.location) : '-'}</td>
                    <td>${record.result ? getResultName(record.result) : '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ========================================
        // CSVå‡ºåŠ›æ©Ÿèƒ½
        // ========================================

        // è¨˜éŒ²ã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function exportRecords() {
            if (records.length === 0) {
                alert('è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            // CSVãƒ˜ãƒƒãƒ€ãƒ¼
            let csv = 'æ™‚åˆ»,ãƒãƒ¼ãƒ ,é¸æ‰‹ç•ªå·,ã‚¢ã‚¯ã‚·ãƒ§ãƒ³,ä½ç½®,çµæœ\n';

            // ãƒ‡ãƒ¼ã‚¿è¡Œã‚’è¿½åŠ 
            records.forEach(record => {
                csv += `${record.time},`;
                csv += `${getTeamName(record.team)},`;
                csv += `${record.playerNumber},`;
                csv += `${getActionName(record.action)},`;
                csv += `${record.location ? getLocationName(record.location) : ''},`;
                csv += `${record.result ? getResultName(record.result) : ''}\n`;
            });

            // Blobã‚’ä½œæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `handball_record_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('CSVå‡ºåŠ›ãŒå®Œäº†ã—ã¾ã—ãŸ');
        }

        // ========================================
        // LocalStorageä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
        // ========================================

        // ãƒ‡ãƒ¼ã‚¿ã‚’LocalStorageã«ä¿å­˜
        function saveToLocalStorage() {
            const data = {
                halfTime: halfTime,
                myTeamPlayers: myTeamPlayers,
                records: records,
                timerSeconds: timerSeconds
            };
            localStorage.setItem('handballRecorderData', JSON.stringify(data));
        }

        // LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('handballRecorderData');
            if (!savedData) return;

            try {
                const data = JSON.parse(savedData);

                // ãƒãƒ¼ãƒ•ã‚¿ã‚¤ãƒ 
                halfTime = typeof data.halfTime === "number" ? data.halfTime : 25;

                // â˜…å¿…ãšé…åˆ—ãƒã‚§ãƒƒã‚¯ï¼ˆä»Šå›ã®æ ¸å¿ƒï¼‰
                myTeamPlayers = Array.isArray(data.myTeamPlayers) ? data.myTeamPlayers : [];

                // è¨˜éŒ²
                records = Array.isArray(data.records) ? data.records : [];

                // ã‚¿ã‚¤ãƒãƒ¼
                timerSeconds = typeof data.timerSeconds === "number" ? data.timerSeconds : 0;

            } catch (e) {
                console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", e);
                myTeamPlayers = [];
                records = [];
                timerSeconds = 0;
            }
        }

    </script>
  <!-- ===== JavaScriptã“ã“ã¾ã§ ===== -->

    <script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/handball-recorder/service-worker.js", { scope: "/handball-recorder/" });
    }
    </script>

</body>
</html>





